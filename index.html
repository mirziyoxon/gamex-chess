<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Chess vs Bots</title>
  <style>
    body { display: flex; flex-direction: column; align-items: center; font-family: Arial; }
    #board { display: grid; grid-template-columns: repeat(8, 60px); grid-template-rows: repeat(8, 60px); }
    .square { width: 60px; height: 60px; display: flex; align-items: center; justify-content: center; font-size: 36px; cursor: pointer; }
    .light { background: #f0d9b5; }
    .dark { background: #b58863; }
    #controls { margin: 10px; }
    select { padding: 5px; }
  </style>
</head>
<body>
  <h2>Play Chess vs Bot</h2>
  <div id="controls">
    <label for="bot">Choose Bot:</label>
    <select id="bot" onchange="setBot(this.value)">
      <option value="400">Bot 400</option>
      <option value="800">Bot 800</option>
      <option value="1200">Bot 1200</option>
      <option value="1600">Bot 1600</option>
      <option value="2000">Bot 2000</option>
      <option value="2400">Bot 2400</option>
      <option value="2900">Bot 2900</option>
    </select>
  </div>
  <div id="board"></div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.13.4/chess.min.js"></script>
  <script>
    const boardDiv = document.getElementById("board");
    const game = new Chess();
    let selectedSquare = null;
    let botRating = 400;

    // Stockfish web worker
    const stockfish = new Worker("https://lichess1.org/assets/_nJf7R/stockfish.wasm.js");

    function setBot(rating) {
      botRating = parseInt(rating);
      alert("You are playing against Bot " + botRating);
    }

    function drawBoard() {
      boardDiv.innerHTML = "";
      const board = game.board();
      board.forEach((row, r) => {
        row.forEach((piece, c) => {
          const square = document.createElement("div");
          square.className = "square " + ((r + c) % 2 ? "dark" : "light");
          square.dataset.row = r;
          square.dataset.col = c;
          if (piece) {
            square.textContent = piece.type.toUpperCase();
            if (piece.color === "b") square.style.color = "black";
            else square.style.color = "white";
          }
          boardDiv.appendChild(square);
        });
      });
    }

    function playerMove(from, to) {
      const move = game.move({ from, to, promotion: "q" });
      if (move) {
        drawBoard();
        setTimeout(computerMove, 500);
      }
    }

    function getStockfishParams(rating) {
      if (rating <= 400) return { skill: 0, depth: 1 };
      if (rating <= 800) return { skill: 2, depth: 2 };
      if (rating <= 1200) return { skill: 5, depth: 3 };
      if (rating <= 1600) return { skill: 8, depth: 4 };
      if (rating <= 2000) return { skill: 12, depth: 8 };
      if (rating <= 2400) return { skill: 16, depth: 12 };
      return { skill: 20, depth: 20 };
    }

    function computerMove() {
      const { skill, depth } = getStockfishParams(botRating);
      const fen = game.fen();
      stockfish.postMessage("setoption name Skill Level value " + skill);
      stockfish.postMessage("position fen " + fen);
      stockfish.postMessage("go depth " + depth);
    }

    stockfish.onmessage = function(event) {
      const line = event.data;
      if (line.startsWith("bestmove")) {
        const move = line.split(" ")[1];
        if (move === "(none)") return;
        game.move({ from: move.substring(0,2), to: move.substring(2,4), promotion: "q" });
        drawBoard();
      }
    };

    boardDiv.addEventListener("click", (e) => {
      const row = e.target.dataset.row;
      const col = e.target.dataset.col;
      if (row === undefined) return;
      const square = "abcdefgh"[col] + (8 - row);
      if (!selectedSquare) {
        selectedSquare = square;
      } else {
        playerMove(selectedSquare, square);
        selectedSquare = null;
      }
    });

    drawBoard();
  </script>
</body>
</html>
